# UDP 用户数据报协议

UDP不保证UDP数据报会到达其最终的目的地，不保证各个数据报的先后顺序跨网络后保持不变，不保证每个数据报只到达一次。

**每个UDP数据包都会有一个长度**。
如果一个数据报正确的到达其目的地，那么该数据报的长度将随数据一道传递给接收端应用进程。
而TCP是一个 *字节流(byte-stream)* 协议，没有记录任何边界。

UDP提供的是一种 *无连接(connectionless)* 服务，因为UDP客户端与服务器之间不必存在任何长期的关系。

---

# TCP 传输控制协议

当TCP向另一端发送数据时，它要求对方返回一个确认。  
如果没有收到确认，TCP就自动重传并等待更长的时间。

TCP通过给其中每个**字节**关联一个序号，对所发送的数据进行排序(sequencing)。

TCP提供 *流量控制(flow control)*。  
TCP总是告知对端在任何时刻它一次能够从对端接收多少字节的数据，这称为 *通告窗口(advertised window)*。  
在任何时刻，该窗口指出接收缓冲区中当前可用的空间量，从而确保接收数据时不会使接收缓冲区溢出。  
该窗口**时刻动态变化着**：
* 当接收到来自发送端的数据时，窗口大小就减小；
* 当接收端应用从接收缓冲区张读取数据时，窗口大小就增大。

TCP有一个 *MSS(maximum segment size，最大分节大小)*，用于向对端TCP通告对端在每个分节中能发送的最大TCP数据量。  
MSS存在与 *SYN分节* 中。  
MSS的目的是告诉对端其重组缓冲区大小的实际值，从而试图避免分片。
MSS经常设置成MTU减去IP和TCP首部的固定长度。

## TCP 建立连接
TCP 建立连接需要需要**三次**分组交换，称之为*三路握手(three-way handshake)*。

SYN *j*  
SYN *k*, ACK *j+1*  
ACK *k+1*  

被动打开(passive open) vs. 主动打开(active open)

## TCP关闭连接
TCP 关闭连接需要**四次**分组交换。

主动关闭(active close) vs. 被动关闭(passive close)

FIN *M*  
ACK *M+1*  --> 进入 *半关闭(half-close)* 状态  
FIN *N*
ACK *N+1*